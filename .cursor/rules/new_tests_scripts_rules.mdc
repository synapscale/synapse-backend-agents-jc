---
description: "Regras para gerenciamento de scripts de teste, validaÃ§Ã£o e anÃ¡lise"
globs: ["**/*.py"]
alwaysApply: true
---
# ğŸ§ª REGRA CRÃTICA - GERENCIAMENTO DE SCRIPTS DE TESTE

## **ğŸš¨ REGRA ABSOLUTA: REUTILIZAR ANTES DE CRIAR**

**CONTEXTO**: O repositÃ³rio estÃ¡ sendo poluÃ­do com scripts de teste/validaÃ§Ã£o/anÃ¡lise duplicados e abandonados. Precisamos manter organizaÃ§Ã£o e reutilizar cÃ³digo existente.

**âŒ PROIBIDO:**
- Criar novos scripts de teste/validaÃ§Ã£o/anÃ¡lise sem verificar se jÃ¡ existe similar
- Deixar scripts na raiz do repositÃ³rio quando podem estar em `tests/`
- Abandonar scripts apÃ³s uso sem limpeza
- Duplicar lÃ³gica de teste em novos arquivos
- Criar scripts pontuais sem plano de limpeza

**âœ… OBRIGATÃ“RIO:**

## 1. **VERIFICAÃ‡ÃƒO ANTES DE CRIAR**
```bash
# âœ… SEMPRE verificar scripts existentes primeiro
ls -la *.py | grep -E "(test|check|validate|verify|analyze)"
find tests/ -name "*.py" | grep -i "similar_functionality"
```

## 2. **PRIORIDADE DE REUTILIZAÃ‡ÃƒO**
```python
# âœ… SEMPRE otimizar scripts existentes ao invÃ©s de criar novos
# Exemplo: Se existe test_model_validation.py, EDITAR ele para adicionar novos testes
# ao invÃ©s de criar validate_models_comprehensive.py

# âŒ ERRADO: Criar novo script
# create_file("test_new_validation.py", content="...")

# âœ… CORRETO: Otimizar existente
# edit_file("tests/test_model_validation.py", 
#           old_str="# existing tests", 
#           new_str="# existing tests\n# new validation logic")
```

## 3. **ORGANIZAÃ‡ÃƒO OBRIGATÃ“RIA**
```
âœ… ESTRUTURA CORRETA:
tests/
â”œâ”€â”€ unit/                    # Testes unitÃ¡rios
â”œâ”€â”€ integration/            # Testes de integraÃ§Ã£o
â”œâ”€â”€ analysis/               # Scripts de anÃ¡lise
â”œâ”€â”€ validation/             # Scripts de validaÃ§Ã£o
â””â”€â”€ utils/                  # UtilitÃ¡rios de teste

âŒ EVITAR NA RAIZ:
â”œâ”€â”€ test_something.py       # Deve estar em tests/
â”œâ”€â”€ check_database.py       # Deve estar em tests/analysis/
â”œâ”€â”€ validate_models.py      # Deve estar em tests/validation/
â”œâ”€â”€ analyze_*.py           # Deve estar em tests/analysis/
```

## 4. **SCRIPTS PONTUAIS - LIMPEZA OBRIGATÃ“RIA**
```python
# âœ… Para scripts temporÃ¡rios/pontuais:

# 1. Criar em local adequado
script_path = "tests/temp/temp_analysis_20250107.py"

# 2. Usar com documentaÃ§Ã£o clara
"""
SCRIPT TEMPORÃRIO - DELETAR APÃ“S USO
Criado: 2025-01-07
PropÃ³sito: AnÃ¡lise pontual de performance
Deletar apÃ³s: AnÃ¡lise concluÃ­da
"""

# 3. SEMPRE deletar apÃ³s uso
# TODO: Deletar este script apÃ³s anÃ¡lise concluÃ­da âœ…
```

## 5. **WORKFLOW OBRIGATÃ“RIO**
```bash
# âœ… Antes de criar qualquer script de teste/anÃ¡lise:

# 1. Verificar se existe similar
echo "ğŸ” Verificando scripts existentes..."
find . -name "*.py" -type f | grep -E "(test|check|validate|verify|analyze)" | head -10

# 2. Se existe similar, EDITAR ao invÃ©s de criar novo
echo "âœï¸ Editando script existente ao invÃ©s de criar novo..."

# 3. Se nÃ£o existe, criar em local correto
echo "ğŸ“ Criando em tests/categoria_adequada/"

# 4. Para scripts pontuais, adicionar comentÃ¡rio de limpeza
echo "ğŸ—‘ï¸ Adicionando TODO para limpeza posterior..."

# 5. ApÃ³s uso, SEMPRE limpar
echo "âœ… Limpando scripts temporÃ¡rios..."
```

## 6. **SCRIPTS PERMITIDOS NA RAIZ (APENAS)**

```python
# âœ… ÃšNICOS scripts permitidos na raiz (casos excepcionais):
ALLOWED_ROOT_SCRIPTS = [
    "alembic.ini",           # ConfiguraÃ§Ã£o Alembic
    "dev.sh",                # Script de desenvolvimento
    "prod.sh",               # Script de produÃ§Ã£o  
    "setup.sh",              # Setup inicial do projeto
    "pyproject.toml",        # ConfiguraÃ§Ã£o Python
    "requirements.txt",      # DependÃªncias
    "run_with_memory_bank.py" # Script especÃ­fico do projeto
]

# âŒ Qualquer outro script de teste/anÃ¡lise DEVE estar em tests/
```

## 7. **VERIFICAÃ‡ÃƒO PRÃ‰-COMMIT**
```bash
# âœ… Checklist obrigatÃ³rio antes de commit:
echo "ğŸ“‹ VerificaÃ§Ãµes de scripts:"
echo "- [ ] NÃ£o criei script duplicado quando jÃ¡ existia similar?"
echo "- [ ] Scripts de teste estÃ£o em tests/ e nÃ£o na raiz?"
echo "- [ ] Scripts pontuais tÃªm TODO para limpeza?"
echo "- [ ] Reutilizei cÃ³digo existente ao mÃ¡ximo?"
echo "- [ ] Scripts temporÃ¡rios foram deletados apÃ³s uso?"
```

## 8. **PENALIDADES POR VIOLAÃ‡ÃƒO**
- **1Âª violaÃ§Ã£o**: Refatorar imediatamente
- **2Âª violaÃ§Ã£o**: Revisar toda estrutura de testes
- **3Âª violaÃ§Ã£o**: Limpeza completa do repositÃ³rio

## **ğŸ¯ REGRA DE OURO:**
> "Se existe similar, EDITE. Se nÃ£o existe, crie em tests/. Se Ã© pontual, DELETE apÃ³s uso."

## 9. **EXEMPLOS PRÃTICOS**

### âœ… CORRETO - Reutilizando script existente
```python
# CenÃ¡rio: Preciso validar novos models
# Encontrei: tests/validation/test_model_validation.py

# Ao invÃ©s de criar novo, EDITO o existente:
edit_file("tests/validation/test_model_validation.py",
    old_str="def test_basic_models():",
    new_str="""def test_basic_models():
    # testes existentes...

def test_new_models():
    # novos testes aqui
    pass""")
```

### âŒ INCORRETO - Criando desnecessariamente
```python
# âŒ NÃƒO FAZER: Criar validate_new_models.py quando jÃ¡ existe similar
create_file("validate_new_models.py", content="# duplicando lÃ³gica...")
```

### âœ… CORRETO - Script pontual com limpeza
```python
# Script para anÃ¡lise especÃ­fica e temporÃ¡ria
create_file("tests/temp/analysis_performance_2025_01_07.py", 
    content="""
# SCRIPT TEMPORÃRIO - DELETAR APÃ“S 2025-01-07
# AnÃ¡lise pontual de performance dos endpoints
# TODO: Deletar apÃ³s anÃ¡lise completa
""")

# ApÃ³s uso:
# Bash("rm tests/temp/analysis_performance_2025_01_07.py")
```

## 10. **COMANDOS ÃšTEIS PARA VERIFICAÃ‡ÃƒO**

```bash
# Listar todos os scripts de teste na raiz (para limpeza)
ls -la *.py | grep -E "(test|check|validate|verify|analyze|comprehensive)"

# Encontrar scripts similares por funcionalidade
find . -name "*.py" -exec grep -l "function_similar" {} \;

# Verificar estrutura de tests/
tree tests/ -I "__pycache__"

# Contar scripts duplicados/similares
find . -name "*test*.py" -o -name "*check*.py" -o -name "*validate*.py" | wc -l

# Identificar scripts Ã³rfÃ£os na raiz que deveriam estar em tests/
find . -maxdepth 1 -name "*.py" -type f | grep -E "(test|check|validate|verify|analyze|comprehensive)" | grep -v -E "(alembic|dev|prod|setup|run_with_memory_bank)"
```

## 11. **PROCESSO DE LIMPEZA AUTOMÃTICA**

```bash
# Script de limpeza semanal recomendado
#!/bin/bash

echo "ğŸ§¹ Iniciando limpeza de scripts..."

# 1. Identificar scripts Ã³rfÃ£os na raiz
echo "ğŸ“‹ Scripts Ã³rfÃ£os na raiz:"
find . -maxdepth 1 -name "*.py" -type f | grep -E "(test|check|validate|verify|analyze|comprehensive)" | grep -v -E "(alembic|dev|prod|setup|run_with_memory_bank)"

# 2. Listar scripts temporÃ¡rios antigos
echo "â° Scripts temporÃ¡rios antigos (>7 dias):"
find tests/temp/ -name "*.py" -mtime +7 2>/dev/null || echo "Pasta tests/temp/ nÃ£o existe"

# 3. Verificar duplicaÃ§Ãµes
echo "ğŸ” PossÃ­veis duplicaÃ§Ãµes:"
find . -name "*test*.py" -o -name "*check*.py" -o -name "*validate*.py" | sort | uniq -c | grep -v "1 "

# 4. Sugerir consolidaÃ§Ãµes
echo "ğŸ’¡ SugestÃµes de consolidaÃ§Ã£o disponÃ­veis em .cursor/rules/new_tests_scripts_rules.mdc"
```
